<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="GDM2026.Views.EvenementPage"
             BackgroundColor="#0B0B0B"
             Title="Événements">

    <ContentPage.Resources>
        <Color x:Key="GoldText">#D4AF37</Color>
        <Color x:Key="CardBackground">#151515</Color>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="24" Spacing="18">

            <Border Background="{StaticResource CardBackground}" Stroke="#000" StrokeThickness="1.5" Padding="22">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="18" />
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="12">
                    <Label Text="Événements"
                           FontSize="30"
                           FontAttributes="Bold"
                           TextColor="{StaticResource GoldText}"
                           HorizontalTextAlignment="Center" />
                    <Label Text="Créez ou mettez à jour les événements avec le même guidage que l'Actualité."
                           TextColor="{StaticResource GoldText}"
                           Opacity="0.85"
                           HorizontalTextAlignment="Center" />

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <Button Text="Créer"
                                BackgroundColor="#303030"
                                TextColor="{StaticResource GoldText}"
                                CornerRadius="16"
                                Command="{Binding ShowCreateModeCommand}" />
                        <Button Grid.Column="1"
                                Text="Mettre à jour"
                                BackgroundColor="#303030"
                                TextColor="{StaticResource GoldText}"
                                CornerRadius="16"
                                Command="{Binding ShowUpdateModeCommand}" />
                    </Grid>

                    <Label Text="{Binding StatusMessage}"
                           TextColor="{StaticResource GoldText}"
                           FontSize="14"
                           Opacity="0.9"
                           HorizontalTextAlignment="Center"
                           LineBreakMode="WordWrap" />
                </VerticalStackLayout>
            </Border>

            <Border Background="{StaticResource CardBackground}" Stroke="#000" StrokeThickness="1.5" Padding="18"
                    IsVisible="{Binding IsUpdateMode}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="18" />
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="12">
                    <Label Text="Sélectionnez un événement"
                           FontAttributes="Bold"
                           FontSize="20"
                           TextColor="{StaticResource GoldText}" />

                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                        <Label Text="{Binding SelectedCategoryName}"
                               TextColor="{StaticResource GoldText}"
                               Opacity="0.85"
                               LineBreakMode="WordWrap" />
                        <ActivityIndicator Grid.Column="1"
                                           IsRunning="{Binding IsRefreshing}"
                                           IsVisible="{Binding IsRefreshing}"
                                           Color="{StaticResource GoldText}" />
                    </Grid>

                    <Button Text="{Binding SelectionButtonText}"
                            Command="{Binding ReloadSelectionCommand}"
                            BackgroundColor="#303030"
                            TextColor="{StaticResource GoldText}"
                            CornerRadius="14" />

                    <CollectionView ItemsSource="{Binding PromoCategories}"
                                    SelectionMode="Single"
                                    SelectedItem="{Binding SelectedCategory}"
                                    HeightRequest="220">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="10" />
                        </CollectionView.ItemsLayout>
                        <CollectionView.EmptyView>
                            <Label Text="Appuyez sur « Afficher les événements » pour charger la liste."
                                   HorizontalTextAlignment="Center"
                                   TextColor="{StaticResource GoldText}"
                                   Opacity="0.7" />
                        </CollectionView.EmptyView>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#0F0F0F" Stroke="#2D2D2D" StrokeThickness="1.5" Padding="12">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="14" />
                                    </Border.StrokeShape>
                                    <VerticalStackLayout Spacing="6">
                                        <Label Text="{Binding DisplayName}"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource GoldText}" />
                                        <Label Text="{Binding Name}"
                                               FontSize="13"
                                               TextColor="{StaticResource GoldText}"
                                               Opacity="0.75" />
                                        <Label Text="{Binding Id, StringFormat='ID : {0}'}"
                                               FontSize="12"
                                               TextColor="{StaticResource GoldText}"
                                               Opacity="0.55" />
                                    </VerticalStackLayout>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

            <Border Background="{StaticResource CardBackground}" Stroke="#000" StrokeThickness="1.5" Padding="18"
                    IsVisible="{Binding IsFormSectionVisible}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="18" />
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="12">
                    <Label Text="{Binding FormHeader}"
                           FontAttributes="Bold"
                           FontSize="22"
                           TextColor="{StaticResource GoldText}" />
                    <Label Text="{Binding FormHelperMessage}"
                           TextColor="{StaticResource GoldText}"
                           FontSize="13"
                           Opacity="0.85" />

                    <VerticalStackLayout Spacing="10" IsEnabled="{Binding IsFormInputEnabled}">
                        <Entry Placeholder="Nom de l'événement"
                               BackgroundColor="#101010"
                               TextColor="{StaticResource GoldText}"
                               PlaceholderColor="#7E7030"
                               Text="{Binding NewCategoryName}"
                               IsVisible="{Binding IsCreateMode}" />

                        <Entry Placeholder="Nouveau nom de l'événement"
                               BackgroundColor="#101010"
                               TextColor="{StaticResource GoldText}"
                               PlaceholderColor="#7E7030"
                               Text="{Binding EditCategoryName}"
                               IsVisible="{Binding IsUpdateMode}" />

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12"
                              IsVisible="{Binding IsUpdateMode}">
                            <Button Text="Mettre à jour"
                                    Command="{Binding UpdateCommand}"
                                    BackgroundColor="#303030"
                                    TextColor="{StaticResource GoldText}"
                                    CornerRadius="14" />
                            <Button Grid.Column="1"
                                    Text="Supprimer"
                                    Command="{Binding DeleteCommand}"
                                    BackgroundColor="#5A1A1A"
                                    TextColor="{StaticResource GoldText}"
                                    CornerRadius="14" />
                        </Grid>

                        <Button Text="Créer l'événement"
                                Command="{Binding CreateCommand}"
                                BackgroundColor="#C18F1A"
                                TextColor="{StaticResource GoldText}"
                                CornerRadius="14"
                                IsVisible="{Binding IsCreateMode}" />
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
