<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="GDM2026.CommentsPage"
             x:Name="CommentsPageRoot"
             BackgroundColor="#0B0B0B">

    <ContentPage.Resources>
        <Color x:Key="GoldText">#D4AF37</Color>
        <Color x:Key="CardBackground">#151515</Color>

        <Style TargetType="Label">
            <Setter Property="TextColor" Value="{StaticResource GoldText}" />
        </Style>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,Auto,Auto,*,Auto"
          Padding="24"
          RowSpacing="12">

        <!-- Titre -->
        <Label Grid.Row="0"
               Text="Commentaires"
               FontSize="32"
               FontAttributes="Bold"
               HorizontalTextAlignment="Center" />

        <!-- Statut -->
        <Label Grid.Row="1"
               Text="{Binding CommentsStatusMessage}"
               FontSize="14"
               Opacity="0.85" />

        <!-- Loader -->
        <ActivityIndicator Grid.Row="2"
                           IsRunning="{Binding IsCommentsLoading}"
                           IsVisible="{Binding IsCommentsLoading}"
                           Color="{StaticResource GoldText}" />

        <!-- Liste -->
        <RefreshView Grid.Row="3"
                     Command="{Binding RefreshCommentsCommand}"
                     IsRefreshing="{Binding IsRefreshing}">

            <CollectionView x:Name="CommentsCollection"
                            ItemsSource="{Binding Comments}"
                            SelectionMode="None"
                            ItemsLayout="VerticalList"
                            Margin="0,8,0,0">

                <CollectionView.EmptyView>
                    <Label Text="Aucun commentaire à afficher."
                           HorizontalTextAlignment="Center"
                           Opacity="0.6" />
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="16"
                                Background="{StaticResource CardBackground}"
                                Stroke="#000000"
                                StrokeThickness="1.5"
                                Margin="0,0,0,12">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="16" />
                            </Border.StrokeShape>

                            <VerticalStackLayout Spacing="8">

                                <!-- ⚠️ Mets ici les VRAIES propriétés de ton CommentEntry.
                                     Si tu n’as pas DisplayComment/DisplayNote/DisplayDate/etc,
                                     remplace par les champs réels renvoyés par ton API. -->

                                <Label Text="{Binding DisplayComment}"
                                       FontSize="16"
                                       LineBreakMode="WordWrap" />

                                <Label Text="{Binding DisplayNote}"
                                       FontSize="13"
                                       Opacity="0.85" />

                                <Label Text="{Binding DisplayDate}"
                                       FontSize="12"
                                       Opacity="0.75" />

                                <Label Text="{Binding DisplayUser, StringFormat='Par : {0}'}"
                                       FontSize="13"
                                       Opacity="0.85" />

                                <Label Text="{Binding DisplayProduct, StringFormat='Produit : {0}'}"
                                       FontSize="13"
                                       Opacity="0.85" />

                                <Button Text="Supprimer"
                                        Command="{Binding BindingContext.DeleteCommentCommand, Source={x:Reference CommentsCollection}}"
                                        CommandParameter="{Binding}"
                                        BackgroundColor="#8B1A1A"
                                        TextColor="{StaticResource GoldText}"
                                        CornerRadius="16"
                                        Padding="14,10" />

                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>
        </RefreshView>

        <!-- Voir plus -->
        <Button Grid.Row="4"
                Text="Voir plus"
                Command="{Binding LoadMoreCommand}"
                IsVisible="{Binding CanLoadMore}"
                BackgroundColor="#151515"
                TextColor="{StaticResource GoldText}"
                BorderColor="{StaticResource GoldText}"
                BorderWidth="1"
                CornerRadius="16"
                Padding="14,10"
                Margin="0,8,0,0" />

    </Grid>
</ContentPage>
