<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="GDM2026.CommentsPage"
             x:Name="CommentsPageRoot"
             BackgroundColor="#0B0B0B">
    <ContentPage.Resources>
        <Color x:Key="GoldText">#D4AF37</Color>
        <Color x:Key="CardBackground">#151515</Color>
        <Style TargetType="Label">
            <Setter Property="TextColor" Value="{StaticResource GoldText}" />
        </Style>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="24" Spacing="18">
            <Label Text="Commentaires"
                   FontSize="32"
                   FontAttributes="Bold"
                   HorizontalTextAlignment="Center" />

            <Label Text="Derniers avis postés"
                   FontSize="16"
                   Opacity="0.9" />

            <Label Text="{Binding CommentsStatusMessage}"
                   FontSize="14"
                   Opacity="0.85" />

            <ActivityIndicator IsRunning="{Binding IsCommentsLoading}"
                               IsVisible="{Binding IsCommentsLoading}"
                               Color="{StaticResource GoldText}" />

            <RefreshView Command="{Binding RefreshCommentsCommand}"
                         IsRefreshing="{Binding IsRefreshing}">
                <CollectionView ItemsSource="{Binding Comments}"
                                SelectionMode="None"
                                ItemsLayout="VerticalList"
                                VerticalOptions="Fill">
                    <CollectionView.EmptyView>
                        <Label Text="Aucun commentaire à afficher."
                               HorizontalTextAlignment="Center"
                               Opacity="0.6" />
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="16"
                                    Background="{StaticResource CardBackground}"
                                    Stroke="#000000"
                                    StrokeThickness="1.5">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="16" />
                                </Border.StrokeShape>

                                <VerticalStackLayout Spacing="8">
                                    <Label Text="{Binding DisplayComment}"
                                           FontSize="15"
                                           LineBreakMode="WordWrap" />
                                    <Label Text="{Binding DisplayNote}"
                                           FontSize="13"
                                           Opacity="0.85" />
                                    <Label Text="{Binding DisplayDate}"
                                           FontSize="12"
                                           Opacity="0.75" />
                                    <Label Text="{Binding DisplayUser, StringFormat='Utilisateur : {0}'}"
                                           FontSize="13"
                                           Opacity="0.9" />
                                    <Label Text="{Binding DisplayProduct, StringFormat='Produit : {0}'}"
                                           FontSize="13"
                                           Opacity="0.9" />
                                    <Button Text="Supprimer"
                                            Command="{Binding BindingContext.DeleteCommentCommand, Source={x:Reference CommentsPageRoot}}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="#8B0000"
                                            TextColor="{StaticResource GoldText}"
                                            CornerRadius="10" />
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
