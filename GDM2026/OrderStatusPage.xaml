<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="GDM2026.OrderStatusPage"
             x:Name="OrderStatusPageRoot"
             BackgroundColor="#0B0B0B">
    <ContentPage.Resources>
        <Color x:Key="GoldText">#D4AF37</Color>
        <Color x:Key="CardBackground">#0B0B0B</Color>
        <Color x:Key="CardBorder">#000000</Color>
        <Color x:Key="CardContentText">{StaticResource GoldText}</Color>
        <Style TargetType="Label">
            <Setter Property="TextColor" Value="{StaticResource GoldText}" />
        </Style>
        <Style TargetType="Picker">
            <Setter Property="TextColor" Value="{StaticResource GoldText}" />
            <Setter Property="TitleColor" Value="{StaticResource GoldText}" />
            <Setter Property="BackgroundColor" Value="Transparent" />
        </Style>
        <Style TargetType="Button">
            <Setter Property="TextColor" Value="{StaticResource GoldText}" />
        </Style>
        <Style TargetType="ActivityIndicator">
            <Setter Property="Color" Value="{StaticResource GoldText}" />
        </Style>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="24" Spacing="16">
            <Frame
                BackgroundColor="{StaticResource CardBackground}"
                CornerRadius="18"
                Padding="24"
                HasShadow="True"
                BorderColor="{StaticResource CardBorder}">
                <VerticalStackLayout Spacing="8">
                    <Label
                        x:Name="StatusTitle"
                        FontSize="24"
                        FontAttributes="Bold"
                        HorizontalTextAlignment="Center"
                        TextColor="{StaticResource GoldText}"
                        LineBreakMode="TailTruncation"
                        MaxLines="1" />
                    <Label
                        x:Name="StatusSubtitle"
                        FontSize="14"
                        HorizontalTextAlignment="Center"
                        TextColor="{StaticResource GoldText}"
                        Opacity="0.85" />
                </VerticalStackLayout>
            </Frame>

            <CollectionView x:Name="ProductsCollection" ItemsSource="{Binding Products}" SelectionMode="None">
                <CollectionView.EmptyView>
                    <VerticalStackLayout Padding="12" Spacing="6" HorizontalOptions="Center">
                        <ActivityIndicator IsVisible="{Binding IsLoading}" IsRunning="{Binding IsLoading}" />
                        <Label Text="Aucun produit à afficher pour cet état." TextColor="{StaticResource GoldText}" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame
                            Margin="0,6"
                            Padding="12"
                            BackgroundColor="{StaticResource CardBackground}"
                            CornerRadius="14"
                            HasShadow="False"
                            BorderColor="{StaticResource CardBorder}">
                            <Grid ColumnDefinitions="auto,*,auto" ColumnSpacing="12" VerticalOptions="Center">
                                <Image
                                    Source="{Binding ImageUrl}"
                                    WidthRequest="72"
                                    HeightRequest="72"
                                    Aspect="AspectFill"
                                    HorizontalOptions="Start"
                                    VerticalOptions="Center"
                                    Clip="Rectangle" />
                                <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                                    <Label
                                        Text="{Binding Name}"
                                        FontSize="16"
                                        FontAttributes="Bold"
                                        TextColor="{StaticResource GoldText}"
                                        LineBreakMode="TailTruncation"
                                        MaxLines="1" />
                                    <Label
                                        Text="{Binding CustomerName, StringFormat='Client : {0}'}"
                                        FontSize="12"
                                        TextColor="{StaticResource GoldText}"
                                        Opacity="0.75"
                                        LineBreakMode="TailTruncation"
                                        MaxLines="1" />
                                </VerticalStackLayout>
                                <VerticalStackLayout Grid.Column="2" Spacing="4" HorizontalOptions="End" VerticalOptions="End">
                                    <Border
                                        Stroke="{StaticResource GoldText}"
                                        StrokeThickness="2"
                                        BackgroundColor="Transparent"
                                        Padding="6"
                                        HorizontalOptions="End">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="10" />
                                        </Border.StrokeShape>
                                        <Picker
                                            WidthRequest="90"
                                            HorizontalOptions="End"
                                            ItemsSource="{Binding AvailableStatuses, Source={x:Reference OrderStatusPageRoot}}"
                                            SelectedItem="{Binding CurrentStatus, Mode=OneWay}"
                                            BackgroundColor="Transparent"
                                            TextColor="{StaticResource GoldText}"
                                            TitleColor="{StaticResource GoldText}"
                                            Title="Modifier l'état"
                                            SelectedIndexChanged="OnStatusSelectionChanged" />
                                    </Border>
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
